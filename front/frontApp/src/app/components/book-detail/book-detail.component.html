<div class="book-detail-container" *ngIf="!isLoading && book; else loading">
  <div class="book-header">
    <img *ngIf="book.cover_url" title="cover " [src]="book.cover_url" [alt]="'Portada del libro ' + book.title" class="book-cover">
    <div class="book-info">
      <h1>{{ book.title }}</h1>
      <p><strong>Autor:</strong> {{ book.author }}</p>
      <p *ngIf="book.first_publish_year"><strong>Publicado en:</strong> {{ book.first_publish_year }}</p>

      <p *ngIf="book.genres && book.genres.length > 0">
        <strong>G√©neros:</strong> {{ formatGenres(book.genres) }}
      </p>

      <p *ngIf="book.isbn"><strong>ISBN:</strong> {{ book.isbn }}</p>
    </div>
  </div>

  <div class="description-section">
    <h3>Descripci√≥n</h3>
    <p class="description">{{ book.description || 'No hay descripci√≥n disponible.' }}</p>
  </div>

  <div class="actions">
    <button (click)="isFavorite ? removeFromFavorites() : addToFavorites()">
      {{ isFavorite ? '‚ùå Quitar de Favoritos' : '‚≠ê A√±adir a Favoritos' }}
    </button>
  </div>

  <div *ngIf="isFavorite" class="review-section">
    <h3>Tu rese√±a y valoraci√≥n</h3>

    <div *ngIf="!isEditingReview">
      <blockquote *ngIf="reviewText; else noReview">{{ reviewText }}</blockquote>
      <ng-template #noReview>
        <p class="review-placeholder">A√∫n no has escrito una rese√±a. Haz clic abajo para escribir una.</p>
      </ng-template>
      <button (click)="startEditReview()">‚úèÔ∏è Escribir o editar rese√±a</button>
    </div>

    <div *ngIf="isEditingReview" class="edit-review-form">
      <textarea [(ngModel)]="reviewText" placeholder="Escribe tu rese√±a aqu√≠..."></textarea>
      <div class="review-actions">
        <button [disabled]="!reviewText.trim()" (click)="saveReview()">üíæ Guardar</button>
        <button (click)="cancelEditReview()">‚ùå Cancelar</button>
      </div>
    </div>

    <div class="rating-section">
      <h4>‚≠ê Tu valoraci√≥n</h4>
      <div class="stars">
        <span *ngFor="let star of [1,2,3,4,5]"
              (click)="setRating(star)"
              (mouseenter)="onStarHover(star)"
              (mouseleave)="onStarLeave()"
              [title]="star + ' estrella' + (star > 1 ? 's' : '')"
              [ngClass]="{ 'filled-star': star <= (tempRating || rating), 'empty-star': star > (tempRating || rating) }">
          ‚òÖ
        </span>
      </div>
    </div>
  </div>

  <div class="go-home">
    <button type="button" (click)="navigateToHome()">üè† Volver al inicio</button>
  </div>
</div>

<ng-template #loading>
  <p class="loading-text">‚è≥ Cargando detalles del libro...</p>
</ng-template>
