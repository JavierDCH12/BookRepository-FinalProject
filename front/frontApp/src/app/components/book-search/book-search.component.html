<div class="search-container">
  <!-- ğŸ” Formulario de BÃºsqueda -->
  <div class="search-form">
    <div class="input-group">
      <input type="text" [(ngModel)]="searchParams.title" placeholder="TÃ­tulo" />
    </div>
    <div class="input-group">
      <input type="text" [(ngModel)]="searchParams.author" placeholder="Autor" />
    </div>
    <div class="input-group">
      <input type="text" [(ngModel)]="searchParams.genre" placeholder="GÃ©nero" />
    </div>
    <button class="search-button" (click)="onSearch()">Buscar</button>
  </div>

  <!-- ğŸ“š Resultados -->
  <div class="results-container" *ngIf="hasSearched">

    <!-- â³ Spinner de carga -->
    <div class="spinner-container" *ngIf="isLoading">
      <p-progressSpinner strokeWidth="4" animationDuration=".5s" aria-label="Cargando resultados"></p-progressSpinner>
    </div>

    <!-- âŒ Mensaje solo si NO hay resultados y no se estÃ¡ cargando -->
    <div *ngIf="!isLoading && results.length === 0">
      No se encontraron libros.
    </div>

    <!-- âœ… Resultados -->
    <div class="book-grid" *ngIf="!isLoading && results.length > 0">
      <div class="book-card fade-in" *ngFor="let book of results; trackBy: trackByBookKey">
        <!-- Portada -->
        <div class="book-cover-container">
          <img
            class="book-cover"
            [src]="book.cover_url || defaultCover"
            alt="Portada"
            (click)="navigateToBookDetail(book.book_key)"
            (error)="onImageError($event)"
          />
        </div>

        <!-- Info del libro -->
        <div class="book-info">
          <h4 class="clickable-title" (click)="navigateToBookDetail(book.book_key)">
            {{ book.title }}
          </h4>

          <p class="author" *ngIf="book.author">
            ğŸ‘¤
            <a href="#" (click)="getAuthorWikipediaLink(book.author); $event.preventDefault()">
              {{ book.author }}
            </a>
          </p>

          <p class="publish-year" *ngIf="book.first_publish_year">
            ğŸ“… {{ book.first_publish_year }}
          </p>

          <p class="genres" *ngIf="book.genres">
            ğŸ·ï¸ {{ formatGenres(book.genres) }}
          </p>

          <!-- Favorito -->
          <button class="fav-toggle-button"
                  [class.active]="isFavorite(book.book_key)"
                  (click)="toggleFavorite(book)">
            <i class="pi" [ngClass]="isFavorite(book.book_key) ? 'pi-star-fill' : 'pi-star'"></i>
            {{ isFavorite(book.book_key) ? 'Favorito' : 'AÃ±adir a favoritos' }}
          </button>

          <!-- Wishlist -->
          <button class="wishlist-button"
                  [class.in-wishlist]="isInWishlist(book.book_key)"
                  (click)="toggleWishlist(book)">
            <span class="heart-icon">{{ isInWishlist(book.book_key) ? 'â¤ï¸' : 'ğŸ¤' }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ” Modal de autenticaciÃ³n -->
  <div class="modal-auth-backdrop" *ngIf="isModalAuthOpen">
    <div class="modal-auth">
      <h3>Â¿Quieres guardar este libro?</h3>
      <p>Debes iniciar sesiÃ³n o registrarte para aÃ±adir libros a favoritos o wishlist.</p>
      <div class="auth-buttons">
        <button (click)="navigateToLogin()">Iniciar sesiÃ³n</button>
        <button (click)="navigateToRegister()">Registrarse</button>
      </div>
      <span class="close" (click)="toggleAuthModal(false)">&times;</span>
    </div>
  </div>
</div>
